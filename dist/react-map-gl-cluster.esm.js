import t from"supercluster";import{Children as e,createElement as r,PureComponent as n}from"react";import{MapContext as o}from"@urbica/react-map-gl";function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var c=function(t){return e.toArray(t).map((function(t){return t.key}))},p=function(n){var p,l;function m(o){var u;return i(a(u=n.call(this,o)||this),"_map",void 0),i(a(u),"_cluster",void 0),i(a(u),"_createCluster",(function(r){var n=r.minZoom,o=r.maxZoom,i=r.radius,s=r.extent,a=r.nodeSize,c=r.children,p=r.reduce,l=r.map,m=new t({minZoom:n,maxZoom:o,radius:i,extent:s,nodeSize:a,reduce:p,map:l}),d=e.map(c,(function(t){return e=[t.props.longitude,t.props.latitude],void 0===(r=t)&&(r={}),{type:"Feature",properties:r,geometry:{type:"Point",coordinates:e}};var e,r}));m.load(d),u._cluster=m})),i(a(u),"_recalculate",(function(){var t=u._map.getZoom(),e=u._map.getBounds().toArray(),r=e[0].concat(e[1]),n=u._cluster.getClusters(r,Math.round(t));u.setState((function(){return{clusters:n}}))})),i(a(u),"_renderCluster",(function(t){var e=t.geometry.coordinates,n=e[0],o=e[1],i=t.properties,s=i.cluster_id,a=i.point_count,c=i.point_count_abbreviated;return r(u.props.component,{longitude:n,latitude:o,clusterId:s,pointCount:a,pointCountAbbreviated:c,children:u.children,key:"cluster-"+t.properties.cluster_id})})),u.state={clusters:[]},u}l=n,(p=m).prototype=Object.create(l.prototype),p.prototype.constructor=p,s(p,l);var d=m.prototype;return d.componentDidMount=function(){this._createCluster(this.props),this._recalculate(),this._map.on("moveend",this._recalculate)},d.componentDidUpdate=function(t){(t.minZoom!==this.props.minZoom||t.maxZoom!==this.props.maxZoom||t.radius!==this.props.radius||t.extent!==this.props.extent||t.nodeSize!==this.props.nodeSize||!function(t,r){if(e.count(t)!==e.count(r))return!1;var n=c(t),o=new Set(c(r));return n.every((function(t){return o.has(t)}))}(t.children,this.props.children))&&(this._createCluster(this.props),this._recalculate())},d.componentWillUnmount=function(){this._map&&this._map.getStyle()&&this._map.off("moveend",this._recalculate)},d.getCluster=function(){return this._cluster},d.render=function(){var t=this;return r(o.Consumer,{},(function(e){return e&&(t._map=e),0===t.state.clusters.length?null:t.state.clusters.map((function(e){if(e.properties.cluster)return t._renderCluster(e);var n=e.properties,o=n.type,i=n.key,s=n.props;return r(o,u({key:i},s))}))}))},m}(n);i(p,"displayName","Cluster"),i(p,"defaultProps",{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64});export default p;
//# sourceMappingURL=react-map-gl-cluster.esm.js.map
