"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=(e=require("supercluster"))&&"object"==typeof e&&"default"in e?e.default:e,r=require("react"),n=require("@urbica/react-map-gl");function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var s=function(e){return r.Children.toArray(e).map((function(e){return e.key}))},c=function(e){var c,p;function l(n){var i;return o(a(i=e.call(this,n)||this),"_map",void 0),o(a(i),"_cluster",void 0),o(a(i),"_createCluster",(function(e){var n=e.minZoom,o=e.maxZoom,u=e.radius,a=e.extent,s=e.nodeSize,c=e.children,p=e.reduce,l=e.map,d=new t({minZoom:n,maxZoom:o,radius:u,extent:a,nodeSize:s,reduce:p,map:l}),m=r.Children.map(c,(function(e){return t=[e.props.longitude,e.props.latitude],void 0===(r=e)&&(r={}),{type:"Feature",properties:r,geometry:{type:"Point",coordinates:t}};var t,r}));d.load(m),i._cluster=d})),o(a(i),"_recalculate",(function(){var e=i._map.getZoom(),t=i._map.getBounds().toArray(),r=t[0].concat(t[1]),n=i._cluster.getClusters(r,Math.round(e));i.setState((function(){return{clusters:n}}))})),o(a(i),"_renderCluster",(function(e){var t=e.geometry.coordinates,n=t[0],o=t[1],u=e.properties,a=u.cluster_id,s=u.point_count,c=u.point_count_abbreviated;return r.createElement(i.props.component,{longitude:n,latitude:o,clusterId:a,pointCount:s,pointCountAbbreviated:c,children:i.children,key:"cluster-"+e.properties.cluster_id})})),i.state={clusters:[]},i}p=e,(c=l).prototype=Object.create(p.prototype),c.prototype.constructor=c,u(c,p);var d=l.prototype;return d.componentDidMount=function(){this._createCluster(this.props),this._recalculate(),this._map.on("moveend",this._recalculate)},d.componentDidUpdate=function(e){(e.minZoom!==this.props.minZoom||e.maxZoom!==this.props.maxZoom||e.radius!==this.props.radius||e.extent!==this.props.extent||e.nodeSize!==this.props.nodeSize||!function(e,t){if(r.Children.count(e)!==r.Children.count(t))return!1;var n=s(e),o=new Set(s(t));return n.every((function(e){return o.has(e)}))}(e.children,this.props.children))&&(this._createCluster(this.props),this._recalculate())},d.componentWillUnmount=function(){this._map&&this._map.getStyle()&&this._map.off("moveend",this._recalculate)},d.getCluster=function(){return this._cluster},d.render=function(){var e=this;return r.createElement(n.MapContext.Consumer,{},(function(t){return t&&(e._map=t),0===e.state.clusters.length?null:e.state.clusters.map((function(t){if(t.properties.cluster)return e._renderCluster(t);var n=t.properties,o=n.type,u=n.key,a=n.props;return r.createElement(o,i({key:u},a))}))}))},l}(r.PureComponent);o(c,"displayName","Cluster"),o(c,"defaultProps",{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64}),exports.default=c;
//# sourceMappingURL=react-map-gl-cluster.cjs.js.map
